(function(){var t=this,n=t._,e={},r=Array.prototype,i=Object.prototype,a=Function.prototype,u=r.push,o=r.slice,l=r.concat,c=i.toString,f=i.hasOwnProperty,s=r.forEach,p=r.map,d=r.reduce,h=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,x=Array.isArray,w=Object.keys,E=a.bind,I=function(t){return t instanceof I?t:this instanceof I?void(this._wrapped=t):new I(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=I),exports._=I):t._=I,I.VERSION="1.4.4";var A=I.each=I.forEach=function(t,n,r){if(null!=t)if(s&&t.forEach===s)t.forEach(n,r);else if(t.length===+t.length){for(var i=0,a=t.length;a>i;i++)if(n.call(r,t[i],i,t)===e)return}else for(var u in t)if(I.has(t,u)&&n.call(r,t[u],u,t)===e)return};I.map=I.collect=function(t,n,e){var r=[];return null==t?r:p&&t.map===p?t.map(n,e):(A(t,function(t,i,a){r[r.length]=n.call(e,t,i,a)}),r)};var j="Reduce of empty array with no initial value";I.reduce=I.foldl=I.inject=function(t,n,e,r){var i=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return r&&(n=I.bind(n,r)),i?t.reduce(n,e):t.reduce(n);if(A(t,function(t,a,u){i?e=n.call(r,e,t,a,u):(e=t,i=!0)}),!i)throw new TypeError(j);return e},I.reduceRight=I.foldr=function(t,n,e,r){var i=arguments.length>2;if(null==t&&(t=[]),h&&t.reduceRight===h)return r&&(n=I.bind(n,r)),i?t.reduceRight(n,e):t.reduceRight(n);var a=t.length;if(a!==+a){var u=I.keys(t);a=u.length}if(A(t,function(o,l,c){l=u?u[--a]:--a,i?e=n.call(r,e,t[l],l,c):(e=t[l],i=!0)}),!i)throw new TypeError(j);return e},I.find=I.detect=function(t,n,e){var r;return _(t,function(t,i,a){return n.call(e,t,i,a)?(r=t,!0):void 0}),r},I.filter=I.select=function(t,n,e){var r=[];return null==t?r:v&&t.filter===v?t.filter(n,e):(A(t,function(t,i,a){n.call(e,t,i,a)&&(r[r.length]=t)}),r)},I.reject=function(t,n,e){return I.filter(t,function(t,r,i){return!n.call(e,t,r,i)},e)},I.every=I.all=function(t,n,r){n||(n=I.identity);var i=!0;return null==t?i:m&&t.every===m?t.every(n,r):(A(t,function(t,a,u){return(i=i&&n.call(r,t,a,u))?void 0:e}),!!i)};var _=I.some=I.any=function(t,n,r){n||(n=I.identity);var i=!1;return null==t?i:g&&t.some===g?t.some(n,r):(A(t,function(t,a,u){return i||(i=n.call(r,t,a,u))?e:void 0}),!!i)};I.contains=I.include=function(t,n){return null!=t&&(y&&t.indexOf===y?-1!=t.indexOf(n):_(t,function(t){return t===n}))},I.invoke=function(t,n){var e=o.call(arguments,2),r=I.isFunction(n);return I.map(t,function(t){return(r?n:t[n]).apply(t,e)})},I.pluck=function(t,n){return I.map(t,function(t){return t[n]})},I.where=function(t,n,e){return I.isEmpty(n)?e?null:[]:I[e?"find":"filter"](t,function(t){for(var e in n)if(n[e]!==t[e])return!1;return!0})},I.findWhere=function(t,n){return I.where(t,n,!0)},I.max=function(t,n,e){if(!n&&I.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.max.apply(Math,t);if(!n&&I.isEmpty(t))return-1/0;var r={computed:-1/0,value:-1/0};return A(t,function(t,i,a){var u=n?n.call(e,t,i,a):t;u>=r.computed&&(r={value:t,computed:u})}),r.value},I.min=function(t,n,e){if(!n&&I.isArray(t)&&t[0]===+t[0]&&65535>t.length)return Math.min.apply(Math,t);if(!n&&I.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return A(t,function(t,i,a){var u=n?n.call(e,t,i,a):t;r.computed>u&&(r={value:t,computed:u})}),r.value},I.shuffle=function(t){var n,e=0,r=[];return A(t,function(t){n=I.random(e++),r[e-1]=r[n],r[n]=t}),r};var T=function(t){return I.isFunction(t)?t:function(n){return n[t]}};I.sortBy=function(t,n,e){var r=T(n);return I.pluck(I.map(t,function(t,n,i){return{value:t,index:n,criteria:r.call(e,t,n,i)}}).sort(function(t,n){var e=t.criteria,r=n.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(r>e||void 0===r)return-1}return t.index<n.index?-1:1}),"value")};var C=function(t,n,e,r){var i={},a=T(n||I.identity);return A(t,function(n,u){var o=a.call(e,n,u,t);r(i,o,n)}),i};I.groupBy=function(t,n,e){return C(t,n,e,function(t,n,e){(I.has(t,n)?t[n]:t[n]=[]).push(e)})},I.countBy=function(t,n,e){return C(t,n,e,function(t,n){I.has(t,n)||(t[n]=0),t[n]++})},I.sortedIndex=function(t,n,e,r){for(var i=(e=null==e?I.identity:T(e)).call(r,n),a=0,u=t.length;u>a;){var o=a+u>>>1;i>e.call(r,t[o])?a=o+1:u=o}return a},I.toArray=function(t){return t?I.isArray(t)?o.call(t):t.length===+t.length?I.map(t,I.identity):I.values(t):[]},I.size=function(t){return null==t?0:t.length===+t.length?t.length:I.keys(t).length},I.first=I.head=I.take=function(t,n,e){return null==t?void 0:null==n||e?t[0]:o.call(t,0,n)},I.initial=function(t,n,e){return o.call(t,0,t.length-(null==n||e?1:n))},I.last=function(t,n,e){return null==t?void 0:null==n||e?t[t.length-1]:o.call(t,Math.max(t.length-n,0))},I.rest=I.tail=I.drop=function(t,n,e){return o.call(t,null==n||e?1:n)},I.compact=function(t){return I.filter(t,I.identity)};var S=function(t,n,e){return A(t,function(t){I.isArray(t)?n?u.apply(e,t):S(t,n,e):e.push(t)}),e};I.flatten=function(t,n){return S(t,n,[])},I.without=function(t){return I.difference(t,o.call(arguments,1))},I.uniq=I.unique=function(t,n,e,r){I.isFunction(n)&&(r=e,e=n,n=!1);var i=e?I.map(t,e,r):t,a=[],u=[];return A(i,function(e,r){(n?r&&u[u.length-1]===e:I.contains(u,e))||(u.push(e),a.push(t[r]))}),a},I.union=function(){return I.uniq(l.apply(r,arguments))},I.intersection=function(t){var n=o.call(arguments,1);return I.filter(I.uniq(t),function(t){return I.every(n,function(n){return I.indexOf(n,t)>=0})})},I.difference=function(t){var n=l.apply(r,o.call(arguments,1));return I.filter(t,function(t){return!I.contains(n,t)})},I.zip=function(){for(var t=o.call(arguments),n=I.max(I.pluck(t,"length")),e=Array(n),r=0;n>r;r++)e[r]=I.pluck(t,""+r);return e},I.object=function(t,n){if(null==t)return{};for(var e={},r=0,i=t.length;i>r;r++)n?e[t[r]]=n[r]:e[t[r][0]]=t[r][1];return e},I.indexOf=function(t,n,e){if(null==t)return-1;var r=0,i=t.length;if(e){if("number"!=typeof e)return t[r=I.sortedIndex(t,n)]===n?r:-1;r=0>e?Math.max(0,i+e):e}if(y&&t.indexOf===y)return t.indexOf(n,e);for(;i>r;r++)if(t[r]===n)return r;return-1},I.lastIndexOf=function(t,n,e){if(null==t)return-1;var r=null!=e;if(b&&t.lastIndexOf===b)return r?t.lastIndexOf(n,e):t.lastIndexOf(n);for(var i=r?e:t.length;i--;)if(t[i]===n)return i;return-1},I.range=function(t,n,e){1>=arguments.length&&(n=t||0,t=0),e=arguments[2]||1;for(var r=Math.max(Math.ceil((n-t)/e),0),i=0,a=Array(r);r>i;)a[i++]=t,t+=e;return a},I.bind=function(t,n){if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));var e=o.call(arguments,2);return function(){return t.apply(n,e.concat(o.call(arguments)))}},I.partial=function(t){var n=o.call(arguments,1);return function(){return t.apply(this,n.concat(o.call(arguments)))}},I.bindAll=function(t){var n=o.call(arguments,1);return 0===n.length&&(n=I.functions(t)),A(n,function(n){t[n]=I.bind(t[n],t)}),t},I.memoize=function(t,n){var e={};return n||(n=I.identity),function(){var r=n.apply(this,arguments);return I.has(e,r)?e[r]:e[r]=t.apply(this,arguments)}},I.delay=function(t,n){var e=o.call(arguments,2);return setTimeout(function(){return t.apply(null,e)},n)},I.defer=function(t){return I.delay.apply(I,[t,1].concat(o.call(arguments,1)))},I.throttle=function(t,n){var e,r,i,a,u=0,o=function(){u=new Date,i=null,a=t.apply(e,r)};return function(){var l=new Date,c=n-(l-u);return e=this,r=arguments,0>=c?(clearTimeout(i),i=null,u=l,a=t.apply(e,r)):i||(i=setTimeout(o,c)),a}},I.debounce=function(t,n,e){var r,i;return function(){var a=this,u=arguments,o=e&&!r;return clearTimeout(r),r=setTimeout(function(){r=null,e||(i=t.apply(a,u))},n),o&&(i=t.apply(a,u)),i}},I.once=function(t){var n,e=!1;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}},I.wrap=function(t,n){return function(){var e=[t];return u.apply(e,arguments),n.apply(this,e)}},I.compose=function(){var t=arguments;return function(){for(var n=arguments,e=t.length-1;e>=0;e--)n=[t[e].apply(this,n)];return n[0]}},I.after=function(t,n){return 0>=t?n():function(){return 1>--t?n.apply(this,arguments):void 0}},I.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var n=[];for(var e in t)I.has(t,e)&&(n[n.length]=e);return n},I.values=function(t){var n=[];for(var e in t)I.has(t,e)&&n.push(t[e]);return n},I.pairs=function(t){var n=[];for(var e in t)I.has(t,e)&&n.push([e,t[e]]);return n},I.invert=function(t){var n={};for(var e in t)I.has(t,e)&&(n[t[e]]=e);return n},I.functions=I.methods=function(t){var n=[];for(var e in t)I.isFunction(t[e])&&n.push(e);return n.sort()},I.extend=function(t){return A(o.call(arguments,1),function(n){if(n)for(var e in n)t[e]=n[e]}),t},I.pick=function(t){var n={},e=l.apply(r,o.call(arguments,1));return A(e,function(e){e in t&&(n[e]=t[e])}),n},I.omit=function(t){var n={},e=l.apply(r,o.call(arguments,1));for(var i in t)I.contains(e,i)||(n[i]=t[i]);return n},I.defaults=function(t){return A(o.call(arguments,1),function(n){if(n)for(var e in n)null==t[e]&&(t[e]=n[e])}),t},I.clone=function(t){return I.isObject(t)?I.isArray(t)?t.slice():I.extend({},t):t},I.tap=function(t,n){return n(t),t};var O=function(t,n,e,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t instanceof I&&(t=t._wrapped),n instanceof I&&(n=n._wrapped);var i=c.call(t);if(i!=c.call(n))return!1;switch(i){case"[object String]":return t==n+"";case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var a=e.length;a--;)if(e[a]==t)return r[a]==n;e.push(t),r.push(n);var u=0,o=!0;if("[object Array]"==i){if(o=(u=t.length)==n.length)for(;u--&&(o=O(t[u],n[u],e,r)););}else{var l=t.constructor,f=n.constructor;if(l!==f&&!(I.isFunction(l)&&l instanceof l&&I.isFunction(f)&&f instanceof f))return!1;for(var s in t)if(I.has(t,s)&&(u++,!(o=I.has(n,s)&&O(t[s],n[s],e,r))))break;if(o){for(s in n)if(I.has(n,s)&&!u--)break;o=!u}}return e.pop(),r.pop(),o};I.isEqual=function(t,n){return O(t,n,[],[])},I.isEmpty=function(t){if(null==t)return!0;if(I.isArray(t)||I.isString(t))return 0===t.length;for(var n in t)if(I.has(t,n))return!1;return!0},I.isElement=function(t){return!(!t||1!==t.nodeType)},I.isArray=x||function(t){return"[object Array]"==c.call(t)},I.isObject=function(t){return t===Object(t)},A(["Arguments","Function","String","Number","Date","RegExp"],function(t){I["is"+t]=function(n){return c.call(n)=="[object "+t+"]"}}),I.isArguments(arguments)||(I.isArguments=function(t){return!(!t||!I.has(t,"callee"))}),"function"!=typeof/./&&(I.isFunction=function(t){return"function"==typeof t}),I.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},I.isNaN=function(t){return I.isNumber(t)&&t!=+t},I.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==c.call(t)},I.isNull=function(t){return null===t},I.isUndefined=function(t){return void 0===t},I.has=function(t,n){return f.call(t,n)},I.noConflict=function(){return t._=n,this},I.identity=function(t){return t},I.times=function(t,n,e){for(var r=Array(t),i=0;t>i;i++)r[i]=n.call(e,i);return r},I.random=function(t,n){return null==n&&(n=t,t=0),t+Math.floor(Math.random()*(n-t+1))};var k={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};k.unescape=I.invert(k.escape);var R={escape:RegExp("["+I.keys(k.escape).join("")+"]","g"),unescape:RegExp("("+I.keys(k.unescape).join("|")+")","g")};I.each(["escape","unescape"],function(t){I[t]=function(n){return null==n?"":(""+n).replace(R[t],function(n){return k[t][n]})}}),I.result=function(t,n){if(null==t)return null;var e=t[n];return I.isFunction(e)?e.call(t):e},I.mixin=function(t){A(I.functions(t),function(n){var e=I[n]=t[n];I.prototype[n]=function(){var t=[this._wrapped];return u.apply(t,arguments),B.call(this,e.apply(I,t))}})};var M=0;I.uniqueId=function(t){var n=++M+"";return t?t+n:n},I.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;I.template=function(t,n,e){var r;e=I.defaults({},e,I.templateSettings);var i=RegExp([(e.escape||N).source,(e.interpolate||N).source,(e.evaluate||N).source].join("|")+"|$","g"),a=0,u="__p+='";t.replace(i,function(n,e,r,i,o){return u+=t.slice(a,o).replace(L,function(t){return"\\"+F[t]}),e&&(u+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),r&&(u+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(u+="';\n"+i+"\n__p+='"),a=o+n.length,n}),u+="';\n",e.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{r=Function(e.variable||"obj","_",u)}catch(t){throw t.source=u,t}if(n)return r(n,I);var o=function(t){return r.call(this,t,I)};return o.source="function("+(e.variable||"obj")+"){\n"+u+"}",o},I.chain=function(t){return I(t).chain()};var B=function(t){return this._chain?I(t).chain():t};I.mixin(I),A(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var n=r[t];I.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!=t&&"splice"!=t||0!==e.length||delete e[0],B.call(this,e)}}),A(["concat","join","slice"],function(t){var n=r[t];I.prototype[t]=function(){return B.call(this,n.apply(this._wrapped,arguments))}}),I.extend(I.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(t){jQuery.fn.extend({elastic:function(){var n=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight","border-top-width","border-right-width","border-bottom-width","border-left-width","borderTopStyle","borderTopColor","borderRightStyle","borderRightColor","borderBottomStyle","borderBottomColor","borderLeftStyle","borderLeftColor"];return this.each(function(){if("textarea"!==this.type)return!1;var e=jQuery(this),r=jQuery("<div />").css({position:"absolute",display:"none","word-wrap":"break-word","white-space":"pre-wrap"}),i=parseInt(e.css("line-height"),10)||parseInt(e.css("font-size"),"10"),a=parseInt(e.css("height"),10)||3*i,u=parseInt(e.css("max-height"),10)||Number.MAX_VALUE;u<0&&(u=Number.MAX_VALUE),r.appendTo(e.parent());for(var o=n.length;o--;)r.css(n[o].toString(),e.css(n[o].toString()));function l(){var t=Math.floor(parseInt(e.width(),10));r.width()!==t&&(r.css({width:t+"px"}),f(!0))}function c(t,n){var r=Math.floor(parseInt(t,10));e.height()!==r&&e.css({height:r+"px",overflow:n})}function f(t){var n=e.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),o=r.html().replace(/<br>/gi,"<br />");if((t||n+"&nbsp;"!==o)&&(r.html(n+"&nbsp;"),Math.abs(r.height()+i-e.height())>3)){var l=r.height()>i+3?r.height()+i:r.height();l>=u?c(u,"auto"):c(l<=a?a:l,"hidden")}}e.css({overflow:"hidden"}),e.bind("keyup change cut paste",function(){f()}),t(window).bind("resize",l),e.bind("resize",l),e.bind("update",f),e.bind("input paste",function(t){setTimeout(f,250)}),f()})}})}(jQuery),function(t){t.event.special.input={setup:function(n,e){var r,i=this,a=i.value,u=document.createElement(this.tagName),o="oninput"in u||function(t){if(t.setAttribute("oninput","return"),"function"==typeof t.oninput)return!0;try{document.createEvent("KeyboardEvent");var n=!1,e=function(t){n=!0,t.preventDefault(),t.stopPropagation()};return document.body.appendChild(t),t.addEventListener("input",e,!1),t.removeEventListener("input",e,!1),document.body.removeChild(t),n}catch(t){}}(u),l="inputEventNS"+~~(1e7*Math.random()),c=["focus","blur","paste","cut","keydown","drop",""].join("."+l+" ");function f(){var n=t(i);i.value==a||n.data("triggering.inputEvent")||(a=i.value,n.data("triggering.inputEvent",!0).trigger("input"),window.setTimeout(function(){n.data("triggering.inputEvent",!1)},0))}if(o)return!1;t(this).find("input, textarea").andSelf().filter("input, textarea").bind(c,function(t){"focus"==t.type?(f(),clearInterval(r),r=window.setInterval(f,250)):"blur"==t.type?window.clearInterval(r):window.setTimeout(f,0)}),t(this).data("inputEventHandlerNS",l)},teardown:function(){var n=t(this);n.find("input, textarea").unbind(n.data("inputEventHandlerNS")),n.data("inputEventHandlerNS","")}},t.fn.input=function(t){return t?this.bind("input",t):this.trigger("input")}}(jQuery),function(t,n,e){var r={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188,SPACE:32,HOME:36,END:35},i={triggerChar:"@",onDataRequest:t.noop,minChars:2,showAvatars:!0,elastic:!0,classes:{autoCompleteItemActive:"active"},templates:{wrapper:n.template('<div class="mentions-input-box"></div>'),autocompleteList:n.template('<div class="mentions-autocomplete-list"></div>'),autocompleteListItem:n.template('<li data-ref-id="<%= id %>" data-ref-type="<%= type %>" data-display="<%= display %>"><%= content %></li>'),autocompleteListItemAvatar:n.template('<img src="<%= avatar %>" />'),autocompleteListItemIcon:n.template('<div class="icon <%= icon %>"></div>'),mentionsOverlay:n.template('<div class="mentions"><div></div></div>'),mentionItemSyntax:n.template("@[<%= value %>](<%= type %>:<%= id %>)"),mentionItemHighlight:n.template("<strong><span><%= value %></span></strong>")}},a={htmlEncode:function(t){return n.escape(t)},highlightTerm:function(t,n){return n||n.length?t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+n+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"):t},setCaratPosition:function(t,n){if(t.createTextRange){var e=t.createTextRange();e.move("character",n),e.select()}else t.selectionStart?(t.focus(),t.setSelectionRange(n,n)):t.focus()},rtrim:function(t){return t.replace(/\s+$/,"")}},u=function(e){var u,o,l,c,f,s,p,d=[],h={},v=[];function m(){var t=b();n.each(d,function(n){var r=e.templates.mentionItemSyntax(n);t=t.replace(n.value,r)});var r=a.htmlEncode(t);n.each(d,function(t){var i=n.extend({},t,{value:a.htmlEncode(t.value)}),u=e.templates.mentionItemSyntax(i),o=e.templates.mentionItemHighlight(i);r=r.replace(u,o)}),r=(r=r.replace(/\n/g,"<br />")).replace(/ {2}/g,"&nbsp; "),u.data("messageText",t),f.find("div").html(r)}function g(){v=[]}function y(t){var n=b();p=p||"";var r=new RegExp("\\"+e.triggerChar+p,"gi");r.exec(n);var i=r.lastIndex-p.length-1,o=r.lastIndex,l=n.substr(0,i),c=n.substr(o,n.length),f=(l+t.value).length+1;d.push(t),g(),p="",_();var s=l+t.value+" "+c;u.val(s),m(),u.focus(),a.setCaratPosition(u[0],f)}function b(){return t.trim(u.val())}function x(n){var e=t(this);return y(h[e.attr("data-uid")]),!1}function w(t){g()}function E(t){_()}e=t.extend(!0,{},i,e),n.debounce=function(t,n,e){var r;return function(){var i=this,a=arguments,u=e&&!r;clearTimeout(r),r=setTimeout(function(){r=null,e||t.apply(i,a)},n),u&&t.apply(i,a)}};var I=n.debounce(function(t){var r;m(),r=b(),d=n.reject(d,function(t,n){return!t.value||-1==r.indexOf(t.value)}),d=n.compact(d);var i=n.lastIndexOf(v,e.triggerChar);i>-1&&(p=v.slice(i+1).join(""),p=a.rtrim(p),n.defer(n.bind(C,this,p)))},600);function A(n){v=t(this).val().split("")}function j(e){if(e.keyCode==r.LEFT||e.keyCode==r.RIGHT||e.keyCode==r.HOME||e.keyCode==r.END)return n.defer(g),void(navigator.userAgent.indexOf("MSIE 9")>-1&&n.defer(m));if(e.keyCode!=r.BACKSPACE){if(!l.is(":visible"))return!0;switch(e.keyCode){case r.UP:case r.DOWN:var i=null;return(i=e.keyCode==r.DOWN?s&&s.length?s.next():l.find("li").first():t(s).prev()).length&&T(i),!1;case r.RETURN:case r.TAB:if(s&&s.length)return s.trigger("mousedown"),!1}return!0}v=v.slice(0,-1+v.length)}function _(){s=null,l.empty().hide()}function T(t){l.scrollTop(t[0].offsetTop),t.addClass(e.classes.autoCompleteItemActive),t.siblings().removeClass(e.classes.autoCompleteItemActive),s=t}function C(r){r&&r.length&&r.length>=e.minChars?e.onDataRequest.call(this,"search",r,function(i){!function(r,i){l.show();var u=n.pluck(d,"value");if((i=n.reject(i,function(t){return n.include(u,t.name)})).length){l.empty();var o=t("<ul>").appendTo(l).hide();n.each(i,function(i,u){var l=n.uniqueId("mention_");h[l]=n.extend({},i,{value:i.name});var c=t(e.templates.autocompleteListItem({id:a.htmlEncode(i.id),display:a.htmlEncode(i.name),type:a.htmlEncode(i.type),content:a.highlightTerm(a.htmlEncode(i.name),r)})).attr("data-uid",l);0===u&&T(c),e.showAvatars&&(i.avatar?t(e.templates.autocompleteListItemAvatar({avatar:i.avatar})):t(e.templates.autocompleteListItemIcon({icon:i.icon}))).prependTo(c),c=c.appendTo(o)}),l.show(),o.show()}else _()}(r,i)}):_()}function S(){u.val(""),d=[],m()}return{init:function(n){"true"!=(u=t(n)).attr("data-mentions-input")&&(o=u.parent(),c=t(e.templates.wrapper()),u.wrapAll(c),c=o.find("> div"),u.attr("data-mentions-input","true"),u.bind("keydown",j),u.bind("input",A),u.bind("input",I),u.bind("click",w),u.bind("blur",E),e.elastic&&u.elastic()),(l=t(e.templates.autocompleteList())).appendTo(c),l.delegate("li","mousedown",x),(f=t(e.templates.mentionsOverlay())).prependTo(c),S(),e.prefillMention&&y(e.prefillMention)},val:function(t){if(n.isFunction(t)){var e=d.length?u.data("messageText"):b();t.call(this,e)}},reset:function(){S()},addMention:function(t){y(t)},getMentions:function(t){n.isFunction(t)&&t.call(this,d)}}};t.fn.mentionsInput=function(e,r){var i=arguments;return"object"!=typeof e&&e||(r=e),this.each(function(){var a=t.data(this,"mentionsInput")||t.data(this,"mentionsInput",new u(r));return n.isFunction(a[e])?a[e].apply(this,Array.prototype.slice.call(i,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist"):a.init.call(this,this)})}}(jQuery,_);
